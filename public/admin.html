<!DOCTYPE html>
<html>
<head>
  <title>TiMS Admin Dashboard</title>
</head>
<body>
  <h1>Admin Dashboard</h1>

  <label>URL to Load: <input id="urlInput" /></label><br/>
  <p>Click on a client to send the URL.</p>

  <h2>Connected Clients:</h2>
  <ul id="clientList"></ul>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    socket.emit('register', 'admin', 'adminID', 'Admin');

    socket.on('clientListUpdate', (clients) => {
      const list = document.getElementById('clientList');
      list.innerHTML = '';
      clients.forEach(client => {
        const li = document.createElement('li');

        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.value = client.name;
        nameInput.style.marginRight = '10px';

        nameInput.onchange = () => {
          socket.emit('updateClientName', { targetID: client.id, newName: nameInput.value });
          console.log(nameInput.value)
        };

        nameInput.onclick = (event) => {
          event.stopPropagation();
        };

        li.appendChild(nameInput);

        const infoText = document.createElement('span');
        infoText.textContent = ` (${client.id}) ${client.currentURL}`;
        li.appendChild(infoText);

        li.style.cursor = 'pointer';
        li.onclick = () => sendURL(client.id);
        list.appendChild(li);
      });
    });

    function sendURL(clientID) {
      const url = document.getElementById('urlInput').value;
      socket.emit('sendURL', { targetID: clientID, url });
    }
  </script>
</body>
</html>